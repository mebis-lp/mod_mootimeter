var global,isSupported,minFontSize,shuffleArray,timer,WordCloud;window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var callbacks=[void 0],message="zero-timeout-message";return window.addEventListener("message",(function(evt){if("string"==typeof evt.data&&evt.data.substr(0,message.length)===message){evt.stopImmediatePropagation();var id=parseInt(evt.data.substr(message.length),36);callbacks[id]&&(callbacks[id](),callbacks[id]=void 0)}}),!0),window.clearImmediate=function(id){callbacks[id]&&(callbacks[id]=void 0)},function(callback){var id=callbacks.length;return callbacks.push(callback),window.postMessage(message+id.toString(36),"*"),id}}()||function(fn){window.setTimeout(fn,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(timer){window.clearTimeout(timer)}),global=window,isSupported=function(){var canvas=document.createElement("canvas");if(!canvas||!canvas.getContext)return!1;var ctx=canvas.getContext("2d");return!!(ctx&&ctx.getImageData&&ctx.fillText&&Array.prototype.some&&Array.prototype.push)}(),minFontSize=function(){if(isSupported){for(var hanWidth,mWidth,ctx=document.createElement("canvas").getContext("2d"),size=20;size;){if(ctx.font=size.toString(10)+"px sans-serif",ctx.measureText("Ｗ").width===hanWidth&&ctx.measureText("m").width===mWidth)return size+1;hanWidth=ctx.measureText("Ｗ").width,mWidth=ctx.measureText("m").width,size--}return 0}}(),shuffleArray=function(arr){for(var j,x,i=arr.length;i;)j=Math.floor(Math.random()*i),x=arr[--i],arr[i]=arr[j],arr[j]=x;return arr},timer={},(WordCloud=function(elements,options){if(isSupported){var timerId=Math.floor(Math.random()*Date.now());Array.isArray(elements)||(elements=[elements]),elements.forEach((function(el,i){if("string"==typeof el){if(elements[i]=document.getElementById(el),!elements[i])throw new Error("The element id specified is not found.")}else if(!el.tagName&&!el.appendChild)throw new Error("You must pass valid HTML elements, or ID of the element.")}));var settings={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(options)for(var key in options)key in settings&&(settings[key]=options[key]);if("function"!=typeof settings.weightFactor){var factor=settings.weightFactor;settings.weightFactor=function(pt){return pt*factor}}if("function"!=typeof settings.shape)switch(settings.shape){case"circle":default:settings.shape="circle";break;case"cardioid":settings.shape=function(theta){return 1-Math.sin(theta)};break;case"diamond":settings.shape=function(theta){var thetaPrime=theta%(2*Math.PI/4);return 1/(Math.cos(thetaPrime)+Math.sin(thetaPrime))};break;case"square":settings.shape=function(theta){return Math.min(1/Math.abs(Math.cos(theta)),1/Math.abs(Math.sin(theta)))};break;case"triangle-forward":settings.shape=function(theta){var thetaPrime=theta%(2*Math.PI/3);return 1/(Math.cos(thetaPrime)+Math.sqrt(3)*Math.sin(thetaPrime))};break;case"triangle":case"triangle-upright":settings.shape=function(theta){var thetaPrime=(theta+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(thetaPrime)+Math.sqrt(3)*Math.sin(thetaPrime))};break;case"pentagon":settings.shape=function(theta){var thetaPrime=(theta+.955)%(2*Math.PI/5);return 1/(Math.cos(thetaPrime)+.726543*Math.sin(thetaPrime))};break;case"star":settings.shape=function(theta){var thetaPrime=(theta+.955)%(2*Math.PI/10);return(theta+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-thetaPrime)+3.07768*Math.sin(2*Math.PI/10-thetaPrime)):1/(Math.cos(thetaPrime)+3.07768*Math.sin(thetaPrime))}}settings.gridSize=Math.max(Math.floor(settings.gridSize),4);var grid,ngx,ngy,center,maxRadius,escapeTime,getTextColor,getTextFontWeight,g=settings.gridSize,maskRectWidth=g-settings.maskGapWidth,rotationRange=Math.abs(settings.maxRotation-settings.minRotation),rotationSteps=Math.abs(Math.floor(settings.rotationSteps)),minRotation=Math.min(settings.maxRotation,settings.minRotation);switch(settings.color){case"random-dark":getTextColor=function(){return randomHslColor(10,50)};break;case"random-light":getTextColor=function(){return randomHslColor(50,90)};break;default:"function"==typeof settings.color&&(getTextColor=settings.color)}"function"==typeof settings.fontWeight&&(getTextFontWeight=settings.fontWeight);var getTextClasses=null;"function"==typeof settings.classes&&(getTextClasses=settings.classes);var hovered,interactive=!1,infoGrid=[],getInfoGridFromMouseTouchEvent=function(evt){var clientX,clientY,canvas=evt.currentTarget,rect=canvas.getBoundingClientRect();evt.touches?(clientX=evt.touches[0].clientX,clientY=evt.touches[0].clientY):(clientX=evt.clientX,clientY=evt.clientY);var eventX=clientX-rect.left,eventY=clientY-rect.top,x=Math.floor(eventX*(canvas.width/rect.width||1)/g),y=Math.floor(eventY*(canvas.height/rect.height||1)/g);return infoGrid[x][y]},wordcloudhover=function(evt){var info=getInfoGridFromMouseTouchEvent(evt);hovered!==info&&(hovered=info,info?settings.hover(info.item,info.dimension,evt):settings.hover(void 0,void 0,evt))},wordcloudclick=function(evt){var info=getInfoGridFromMouseTouchEvent(evt);info&&(settings.click(info.item,info.dimension,evt),evt.preventDefault())},pointsAtRadius=[],getPointsAtRadius=function(radius){if(pointsAtRadius[radius])return pointsAtRadius[radius];var T=8*radius,t=T,points=[];for(0===radius&&points.push([center[0],center[1],0]);t--;){var rx=1;"circle"!==settings.shape&&(rx=settings.shape(t/T*2*Math.PI)),points.push([center[0]+radius*rx*Math.cos(-t/T*2*Math.PI),center[1]+radius*rx*Math.sin(-t/T*2*Math.PI)*settings.ellipticity,t/T*2*Math.PI])}return pointsAtRadius[radius]=points,points},exceedTime=function(){return settings.abortThreshold>0&&(new Date).getTime()-escapeTime>settings.abortThreshold},fillGridAt=function(x,y,drawMask,dimension,item){x>=ngx||y>=ngy||x<0||y<0||(grid[x][y]=!1,drawMask&&elements[0].getContext("2d").fillRect(x*g,y*g,maskRectWidth,maskRectWidth),interactive&&(infoGrid[x][y]={item:item,dimension:dimension}))},putWord=function putWord(item){var word,weight,attributes;Array.isArray(item)?(word=item[0],weight=item[1]):(word=item.word,weight=item.weight,attributes=item.attributes);var rotateDeg=0===settings.rotateRatio||Math.random()>settings.rotateRatio?0:0===rotationRange?minRotation:rotationSteps>0?minRotation+Math.floor(Math.random()*rotationSteps)*rotationRange/(rotationSteps-1):minRotation+Math.random()*rotationRange,extraDataArray=function(item){if(Array.isArray(item)){var itemCopy=item.slice();return itemCopy.splice(0,2),itemCopy}return[]}(item),info=function(word,weight,rotateDeg,extraDataArray){var fontSize=settings.weightFactor(weight);if(fontSize<=settings.minSize)return!1;var fontWeight,mu=1;fontSize<minFontSize&&(mu=function(){for(var mu=2;mu*fontSize<minFontSize;)mu+=2;return mu}()),fontWeight=getTextFontWeight?getTextFontWeight(word,weight,fontSize,extraDataArray):settings.fontWeight;var fcanvas=document.createElement("canvas"),fctx=fcanvas.getContext("2d",{willReadFrequently:!0});fctx.font=fontWeight+" "+(fontSize*mu).toString(10)+"px "+settings.fontFamily;var fw=fctx.measureText(word).width/mu,fh=Math.max(fontSize*mu,fctx.measureText("m").width,fctx.measureText("Ｗ").width)/mu,boxWidth=fw+2*fh,boxHeight=3*fh,fgw=Math.ceil(boxWidth/g),fgh=Math.ceil(boxHeight/g);boxWidth=fgw*g,boxHeight=fgh*g;var fillTextOffsetX=-fw/2,fillTextOffsetY=.4*-fh,cgh=Math.ceil((boxWidth*Math.abs(Math.sin(rotateDeg))+boxHeight*Math.abs(Math.cos(rotateDeg)))/g),cgw=Math.ceil((boxWidth*Math.abs(Math.cos(rotateDeg))+boxHeight*Math.abs(Math.sin(rotateDeg)))/g),width=cgw*g,height=cgh*g;fcanvas.setAttribute("width",width),fcanvas.setAttribute("height",height),fctx.scale(1/mu,1/mu),fctx.translate(width*mu/2,height*mu/2),fctx.rotate(-rotateDeg),fctx.font=fontWeight+" "+(fontSize*mu).toString(10)+"px "+settings.fontFamily,fctx.fillStyle="#000",fctx.textBaseline="middle",fctx.fillText(word,fillTextOffsetX*mu,(fillTextOffsetY+.5*fontSize)*mu);var imageData=fctx.getImageData(0,0,width,height).data;if(exceedTime())return!1;for(var gy,x,y,occupied=[],gx=cgw,bounds=[cgh/2,cgw/2,cgh/2,cgw/2];gx--;)for(gy=cgh;gy--;){y=g;singleGridLoop:for(;y--;)for(x=g;x--;)if(imageData[4*((gy*g+y)*width+(gx*g+x))+3]){occupied.push([gx,gy]),gx<bounds[3]&&(bounds[3]=gx),gx>bounds[1]&&(bounds[1]=gx),gy<bounds[0]&&(bounds[0]=gy),gy>bounds[2]&&(bounds[2]=gy);break singleGridLoop}}return{mu:mu,occupied:occupied,bounds:bounds,gw:cgw,gh:cgh,fillTextOffsetX:fillTextOffsetX,fillTextOffsetY:fillTextOffsetY,fillTextWidth:fw,fillTextHeight:fh,fontSize:fontSize}}(word,weight,rotateDeg,extraDataArray);if(!info)return!1;if(exceedTime())return!1;if(!settings.drawOutOfBound&&!settings.shrinkToFit){var bounds=info.bounds;if(bounds[1]-bounds[3]+1>ngx||bounds[2]-bounds[0]+1>ngy)return!1}for(var r=maxRadius+1,tryToPutWordAtPoint=function(gxy){var gx=Math.floor(gxy[0]-info.gw/2),gy=Math.floor(gxy[1]-info.gh/2);return info.gw,info.gh,!!function(gx,gy,gw,gh,occupied){for(var i=occupied.length;i--;){var px=gx+occupied[i][0],py=gy+occupied[i][1];if(px>=ngx||py>=ngy||px<0||py<0){if(!settings.drawOutOfBound)return!1}else if(!grid[px][py])return!1}return!0}(gx,gy,0,0,info.occupied)&&(function(gx,gy,info,word,weight,distance,theta,rotateDeg,attributes,extraDataArray){var color,fontWeight,classes,fontSize=info.fontSize;color=getTextColor?getTextColor(word,weight,fontSize,distance,theta,extraDataArray):settings.color,fontWeight=getTextFontWeight?getTextFontWeight(word,weight,fontSize,extraDataArray):settings.fontWeight,classes=getTextClasses?getTextClasses(word,weight,fontSize,extraDataArray):settings.classes,elements.forEach((function(el){if(el.getContext){var ctx=el.getContext("2d"),mu=info.mu;ctx.save(),ctx.scale(1/mu,1/mu),ctx.font=fontWeight+" "+(fontSize*mu).toString(10)+"px "+settings.fontFamily,ctx.fillStyle=color,ctx.translate((gx+info.gw/2)*g*mu,(gy+info.gh/2)*g*mu),0!==rotateDeg&&ctx.rotate(-rotateDeg),ctx.textBaseline="middle",ctx.fillText(word,info.fillTextOffsetX*mu,(info.fillTextOffsetY+.5*fontSize)*mu),ctx.restore()}else{var span=document.createElement("span"),transformRule="";transformRule="rotate("+-rotateDeg/Math.PI*180+"deg) ",1!==info.mu&&(transformRule+="translateX(-"+info.fillTextWidth/4+"px) scale("+1/info.mu+")");var styleRules={position:"absolute",display:"block",font:fontWeight+" "+fontSize*info.mu+"px "+settings.fontFamily,left:(gx+info.gw/2)*g+info.fillTextOffsetX+"px",top:(gy+info.gh/2)*g+info.fillTextOffsetY+"px",width:info.fillTextWidth+"px",height:info.fillTextHeight+"px",lineHeight:fontSize+"px",whiteSpace:"nowrap",transform:transformRule,webkitTransform:transformRule,msTransform:transformRule,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(var cssProp in color&&(styleRules.color=color),span.textContent=word,styleRules)span.style[cssProp]=styleRules[cssProp];if(attributes)for(var attribute in attributes)span.setAttribute(attribute,attributes[attribute]);classes&&(span.className+=classes),el.appendChild(span)}}))}(gx,gy,info,word,weight,maxRadius-r,gxy[2],rotateDeg,attributes,extraDataArray),function(gx,gy,gw,gh,info,item){var ctx,dimension,occupied=info.occupied,drawMask=settings.drawMask;if(drawMask&&((ctx=elements[0].getContext("2d")).save(),ctx.fillStyle=settings.maskColor),interactive){var bounds=info.bounds;dimension={x:(gx+bounds[3])*g,y:(gy+bounds[0])*g,w:(bounds[1]-bounds[3]+1)*g,h:(bounds[2]-bounds[0]+1)*g}}for(var i=occupied.length;i--;){var px=gx+occupied[i][0],py=gy+occupied[i][1];px>=ngx||py>=ngy||px<0||py<0||fillGridAt(px,py,drawMask,dimension,item)}drawMask&&ctx.restore()}(gx,gy,0,0,info,item),!0)};r--;){var points=getPointsAtRadius(maxRadius-r);if(settings.shuffle&&(points=[].concat(points),shuffleArray(points)),points.some(tryToPutWordAtPoint))return!0}return!!settings.shrinkToFit&&(Array.isArray(item)?item[1]=3*item[1]/4:item.weight=3*item.weight/4,putWord(item))},sendEvent=function(type,cancelable,details){if(cancelable)return!elements.some((function(el){var event=new CustomEvent(type,{detail:details||{}});return!el.dispatchEvent(event)}),this);elements.forEach((function(el){var event=new CustomEvent(type,{detail:details||{}});el.dispatchEvent(event)}),this)};!function(){var canvas=elements[0];if(canvas.getContext)ngx=Math.ceil(canvas.width/g),ngy=Math.ceil(canvas.height/g);else{var rect=canvas.getBoundingClientRect();ngx=Math.ceil(rect.width/g),ngy=Math.ceil(rect.height/g)}if(sendEvent("wordcloudstart",!0)){var gx,gy,i,loopingFunction,stoppingFunction;if(center=settings.origin?[settings.origin[0]/g,settings.origin[1]/g]:[ngx/2,ngy/2],maxRadius=Math.floor(Math.sqrt(ngx*ngx+ngy*ngy)),grid=[],!canvas.getContext||settings.clearCanvas)for(elements.forEach((function(el){if(el.getContext){var ctx=el.getContext("2d");ctx.fillStyle=settings.backgroundColor,ctx.clearRect(0,0,ngx*(g+1),ngy*(g+1)),ctx.fillRect(0,0,ngx*(g+1),ngy*(g+1))}else el.textContent="",el.style.backgroundColor=settings.backgroundColor,el.style.position="relative"})),gx=ngx;gx--;)for(grid[gx]=[],gy=ngy;gy--;)grid[gx][gy]=!0;else{var bctx=document.createElement("canvas").getContext("2d");bctx.fillStyle=settings.backgroundColor,bctx.fillRect(0,0,1,1);var x,y,bgPixel=bctx.getImageData(0,0,1,1).data,imageData=canvas.getContext("2d").getImageData(0,0,ngx*g,ngy*g).data;for(gx=ngx;gx--;)for(grid[gx]=[],gy=ngy;gy--;){y=g;singleGridLoop:for(;y--;)for(x=g;x--;)for(i=4;i--;)if(imageData[4*((gy*g+y)*ngx*g+(gx*g+x))+i]!==bgPixel[i]){grid[gx][gy]=!1;break singleGridLoop}!1!==grid[gx][gy]&&(grid[gx][gy]=!0)}imageData=bctx=bgPixel=void 0}if(settings.hover||settings.click){for(interactive=!0,gx=ngx+1;gx--;)infoGrid[gx]=[];settings.hover&&canvas.addEventListener("mousemove",wordcloudhover),settings.click&&(canvas.addEventListener("click",wordcloudclick),canvas.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),canvas.addEventListener("wordcloudstart",(function stopInteraction(){canvas.removeEventListener("wordcloudstart",stopInteraction),canvas.removeEventListener("mousemove",wordcloudhover),canvas.removeEventListener("click",wordcloudclick),hovered=void 0}))}i=0,0!==settings.wait?(loopingFunction=window.setTimeout,stoppingFunction=window.clearTimeout):(loopingFunction=window.setImmediate,stoppingFunction=window.clearImmediate);var removeEventListener=function(type,listener){elements.forEach((function(el){el.removeEventListener(type,listener)}),this)},anotherWordCloudStart=function anotherWordCloudStart(){removeEventListener("wordcloudstart",anotherWordCloudStart),stoppingFunction(timer[timerId])};!function(type,listener){elements.forEach((function(el){el.addEventListener(type,listener)}),this)}("wordcloudstart",anotherWordCloudStart),timer[timerId]=loopingFunction((function loop(){if(i>=settings.list.length)return stoppingFunction(timer[timerId]),sendEvent("wordcloudstop",!1),removeEventListener("wordcloudstart",anotherWordCloudStart),void delete timer[timerId];escapeTime=(new Date).getTime();var drawn=putWord(settings.list[i]),canceled=!sendEvent("wordclouddrawn",!0,{item:settings.list[i],drawn:drawn});if(exceedTime()||canceled)return stoppingFunction(timer[timerId]),settings.abort(),sendEvent("wordcloudabort",!1),sendEvent("wordcloudstop",!1),removeEventListener("wordcloudstart",anotherWordCloudStart),void delete timer[timerId];i++,timer[timerId]=loopingFunction(loop,settings.wait)}),settings.wait)}}()}function randomHslColor(min,max){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(max-min)+min).toFixed()+"%)"}}).isSupported=isSupported,WordCloud.minFontSize=minFontSize,WordCloud.stop=function(){if(timer)for(var timerId in timer)window.clearImmediate(timer[timerId])},"function"==typeof define&&define.amd?(global.WordCloud=WordCloud,define("mootimetertool_wordcloud/wordcloud2",[],(function(){return WordCloud}))):"undefined"!=typeof module&&module.exports?module.exports=WordCloud:global.WordCloud=WordCloud;

//# sourceMappingURL=wordcloud2.min.js.map