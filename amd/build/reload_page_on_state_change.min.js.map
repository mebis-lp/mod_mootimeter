{"version":3,"file":"reload_page_on_state_change.min.js","sources":["../src/reload_page_on_state_change.js"],"sourcesContent":["import {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\n\nexport const init = (id) => {\n    if (!document.getElementById('mootimeterstate').dataset.pageid) {\n        return;\n    }\n\n    setTimeout(() => {\n        const intervalms = document.getElementById('mootimeterstate').dataset.refreshinterval;\n        const interval = setInterval(() => {\n            if (!document.getElementById(id)) {\n                clearInterval(interval);\n                return;\n            }\n            reloadPageOnStateChange();\n        }, intervalms);\n    }, 2500);\n};\n\n/**\n * Refresh the page on a state change.\n * @returns {mixed}\n */\nconst reloadPageOnStateChange = () => {\n    const mtmstate = document.getElementById('mootimeterstate');\n\n    // Early exit if there are no changes.\n    if (mtmstate.dataset.lastupdated == mtmstate.dataset.contentchangedat) {\n        return;\n    }\n\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const cmid = urlParams.get('id');\n\n    reloadPage(mtmstate.dataset.pageid, cmid, mtmstate.dataset);\n\n    // Set lastupdated.\n    let nodelastupdated = document.getElementById('mootimeterstate');\n    nodelastupdated.setAttribute('data-lastupdated', mtmstate.dataset.contentchangedat);\n};\n"],"names":["id","document","getElementById","dataset","pageid","setTimeout","intervalms","refreshinterval","interval","setInterval","reloadPageOnStateChange","clearInterval","mtmstate","lastupdated","contentchangedat","queryString","window","location","search","cmid","URLSearchParams","get","setAttribute"],"mappings":"yNAEqBA,KACZC,SAASC,eAAe,mBAAmBC,QAAQC,QAIxDC,YAAW,WACDC,WAAaL,SAASC,eAAe,mBAAmBC,QAAQI,gBAChEC,SAAWC,aAAY,KACpBR,SAASC,eAAeF,IAI7BU,0BAHIC,cAAcH,YAInBF,cACJ,aAODI,wBAA0B,WACtBE,SAAWX,SAASC,eAAe,sBAGrCU,SAAST,QAAQU,aAAeD,SAAST,QAAQW,8BAI/CC,YAAcC,OAAOC,SAASC,OAE9BC,KADY,IAAIC,gBAAgBL,aACfM,IAAI,sCAEhBT,SAAST,QAAQC,OAAQe,KAAMP,SAAST,SAG7BF,SAASC,eAAe,mBAC9BoB,aAAa,mBAAoBV,SAAST,QAAQW"}