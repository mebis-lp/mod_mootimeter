{"version":3,"file":"toggle_state.min.js","sources":["../src/toggle_state.js"],"sourcesContent":["import {call as fetchMany} from 'core/ajax';\nimport Log from 'core/log';\nimport {execReloadPage as reloadPage} from 'mod_mootimeter/reload_page';\n\n/**\n * Initializing this module.\n * @param {*} ids consists of two elements [containerid, iconid]\n */\nexport const init = (ids) => {\n\n    const containerid = ids[0];\n\n    var obj = document.getElementById(containerid);\n\n    if (!document.getElementById(containerid)) {\n        return;\n    }\n\n    obj.addEventListener(\"click\", toggleState);\n\n    /**\n     * Store the value.\n     */\n    function toggleState() {\n        var pageid = this.dataset.pageid;\n        var containerid = this.id;\n        var iconid = this.dataset.iconid;\n        exectoggleState(pageid, containerid, iconid);\n    }\n};\n\n/**\n * Call to store input value\n * @param {int} pageid\n * @param {string} statename\n * @returns {mixed}\n */\nconst storeInputValue = (\n    pageid,\n    statename\n) => fetchMany([{\n    methodname: 'mod_mootimeter_toggle_state',\n    args: {\n        pageid,\n        statename\n    },\n}])[0];\n\n/**\n * Executes the call to store input value.\n * @param {int} pageid\n * @param {string} containerid\n * @param {string} iconid\n */\nconst exectoggleState = async(pageid, containerid, iconid) => {\n    var statename = document.getElementById(containerid).dataset.togglename;\n    const response = await storeInputValue(pageid, statename);\n\n    if (response.code != 200) {\n        Log.error(response.string);\n    }\n\n    if (response.code == 200) {\n\n        var element = document.getElementById(containerid);\n        var dataset = element.dataset;\n\n        document.getElementById(iconid).classList.remove(dataset.iconenabled);\n        document.getElementById(iconid).classList.remove(dataset.icondisabled);\n\n        if (response.newstate == 1) {\n            document.getElementById(iconid).classList.add(dataset.iconenabled);\n            document.getElementById(containerid).setAttribute('data-original-title', dataset.tooltipdisabled);\n        }\n\n        if (response.newstate != 1) {\n            document.getElementById(iconid).classList.add(dataset.icondisabled);\n            document.getElementById(containerid).setAttribute('data-original-title', dataset.tooltipenabled);\n        }\n\n        // To force the webservice to pull all results.\n        let nodelastupdated = document.getElementById('mootimeterstate');\n        nodelastupdated.setAttribute('data-lastupdated', 0);\n\n        const queryString = window.location.search;\n        const urlParams = new URLSearchParams(queryString);\n        const cmid = urlParams.get('id');\n        dataset.useUrlParams = 1;\n        reloadPage(dataset.pageid, cmid, dataset);\n    }\n};"],"names":["ids","containerid","obj","document","getElementById","addEventListener","pageid","this","dataset","id","iconid","exectoggleState","async","statename","togglename","response","methodname","args","storeInputValue","code","error","string","classList","remove","iconenabled","icondisabled","newstate","add","setAttribute","tooltipdisabled","tooltipenabled","queryString","window","location","search","cmid","URLSearchParams","get","useUrlParams"],"mappings":"sSAQqBA,YAEXC,YAAcD,IAAI,OAEpBE,IAAMC,SAASC,eAAeH,aAE7BE,SAASC,eAAeH,cAI7BC,IAAIG,iBAAiB,wBAMbC,OAASC,KAAKC,QAAQF,OACtBL,YAAcM,KAAKE,GACnBC,OAASH,KAAKC,QAAQE,OAC1BC,gBAAgBL,OAAQL,YAAaS,kBA2BvCC,gBAAkBC,MAAMN,OAAQL,YAAaS,cAC3CG,UAAYV,SAASC,eAAeH,aAAaO,QAAQM,iBACvDC,cAnBc,EACpBT,OACAO,aACC,cAAU,CAAC,CACZG,WAAY,8BACZC,KAAM,CACFX,OAAAA,OACAO,UAAAA,cAEJ,GAUuBK,CAAgBZ,OAAQO,cAE1B,KAAjBE,SAASI,mBACLC,MAAML,SAASM,QAGF,KAAjBN,SAASI,KAAa,KAGlBX,QADUL,SAASC,eAAeH,aAChBO,QAEtBL,SAASC,eAAeM,QAAQY,UAAUC,OAAOf,QAAQgB,aACzDrB,SAASC,eAAeM,QAAQY,UAAUC,OAAOf,QAAQiB,cAEhC,GAArBV,SAASW,WACTvB,SAASC,eAAeM,QAAQY,UAAUK,IAAInB,QAAQgB,aACtDrB,SAASC,eAAeH,aAAa2B,aAAa,sBAAuBpB,QAAQqB,kBAG5D,GAArBd,SAASW,WACTvB,SAASC,eAAeM,QAAQY,UAAUK,IAAInB,QAAQiB,cACtDtB,SAASC,eAAeH,aAAa2B,aAAa,sBAAuBpB,QAAQsB,iBAI/D3B,SAASC,eAAe,mBAC9BwB,aAAa,mBAAoB,SAE3CG,YAAcC,OAAOC,SAASC,OAE9BC,KADY,IAAIC,gBAAgBL,aACfM,IAAI,MAC3B7B,QAAQ8B,aAAe,kCACZ9B,QAAQF,OAAQ6B,KAAM3B"}